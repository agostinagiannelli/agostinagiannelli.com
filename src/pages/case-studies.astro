---
import { getCollection } from "astro:content";
import Layout from "@/layouts/Layout.astro";
import Container from "@/components/Container.astro";
import Heading1 from "@/components/Heading1.astro";
import Block from "@/components/Block.astro";
import BadgeCategory from "@/components/BadgeCategory.astro";

const cases = await getCollection("case");

cases.sort((a, b) => a.data.order - b.data.order);

const categories = Array.from(new Set(cases.map((p) => p.data.category))).sort(
  (a, b) => a.localeCompare(b),
);
---

<Layout title="Agostina Giannelli • Case Studies">
  <Container>
    <Heading1
      h1="Case Studies"
      paragraph="Explore a selection of CRO case studies showcasing proven strategies and results"
    />

    <div id="unauthorized" class="mt-16 hidden">
      <Block
        h2="Glad You Stopped By"
        paragraph="Case studies are password-protected. Want to explore?"
        link="/login"
        linkText="Login"
      />
    </div>

    <div id="authorized" class="mt-16 hidden">
      <div class="flex justify-center flex-wrap gap-2 mb-12">
        <div
          class="flex items-center transition md:justify-center md:hover:scale-105"
        >
          <BadgeCategory category="all" />
        </div>
        {
          categories.map((category) => (
            <div class="flex items-center transition md:justify-center md:hover:scale-105">
              <BadgeCategory category={category} />
            </div>
          ))
        }
      </div>
      <ul class="grid md:grid-cols-2 lg:grid-cols-3 gap-14 md:gap-6">
        {
          cases.map(
            (entry: {
              slug: string;
              data: {
                title: string;
                subtitle: string;
                category: string;
                image: { src: string; alt: string | null };
              };
            }) => (
              <li class={`case ${entry.data.category.replace(/\s+/g, "-")}`}>
                <a href={`/case/${entry.slug}`}>
                  <div>
                    <p class="uppercase tracking-wider text-sm font-medium text-black dark:text-white">
                      {entry.data.category}
                    </p>
                    <h2 class="text-2xl font-semibold leading-snug tracking-tight mt-4 text-black dark:text-white">
                      {entry.data.title}
                    </h2>
                    <p class="text-slate-500 dark:text-slate-200 mt-4">
                      {entry.data.subtitle}
                    </p>
                    <div class="mt-4 text-slate-500 dark:text-white">
                      <a
                        href={`/case/${entry.slug}`}
                        class="relative dark:after:bg-white after:bg-slate-500 after:absolute after:h-0.5 after:w-0 after:bottom-0 after:left-0 hover:after:w-full after:transition-all after:duration-300 cursor-pointer"
                      >
                        → Read Case Study
                      </a>
                    </div>
                  </div>
                </a>
              </li>
            ),
          )
        }
      </ul>
    </div>
  </Container>

  <script src="../utils/authContent.js"></script>
  <script src="../utils/filter.js"></script>
</Layout>
