---
import { getCollection } from "astro:content";
import Layout from "@/layouts/Layout.astro";
import Container from "@/components/Container.astro";
import Heading1 from "@/components/Heading1.astro";
import Block from "@/components/Block.astro";
import BadgeCategory from "@/components/BadgeCategory.astro";
import CaseCard from "@/components/CaseCard.astro";

const cases = await getCollection("case");

cases.sort((a, b) => a.data.order - b.data.order);

const categories = Array.from(new Set(cases.map((p) => p.data.category))).sort(
  (a, b) => a.localeCompare(b),
);
---

<Layout title="Agostina Giannelli â€¢ Case Studies">
  <Container>
    <Heading1
      h1="Case Studies"
      paragraph="Explore a selection of CRO case studies showcasing proven strategies and results"
    />

    <div id="unauthorized" class="hidden mt-16">
      <Block
        h2="Glad You Stopped By"
        paragraph="Case studies are password-protected. Want to explore?"
        href="/login"
        text="Login"
      />
    </div>

    <div id="authorized" class="hidden mt-16">
      <div class="flex flex-wrap justify-center gap-2 mb-12 md:gap-4">
        <BadgeCategory category="All" />
        {categories.map((category) => <BadgeCategory category={category} />)}
      </div>
      <ul class="grid gap-16 md:grid-cols-2 lg:grid-cols-3 md:gap-6">
        {
          cases.map((entry) => (
            <CaseCard
              category={entry.data.category}
              slug={entry.slug}
              title={entry.data.title}
              subtitle={entry.data.subtitle}
            />
          ))
        }
      </ul>
    </div>
  </Container>

  <script src="../utils/authContent.js"></script>
  <script src="../utils/filter.js"></script>
</Layout>
