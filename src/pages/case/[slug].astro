---
import { getCollection } from "astro:content";
import Layout from "@/layouts/Layout.astro";
import Container from "@/components/Container.astro";
import ButtonLink from "@/components/ButtonLink.astro";
import Block from "@/components/Block.astro";

const { entry } = Astro.props;

export async function getStaticPaths() {
  const cases = await getCollection("case");
  return cases.map((entry: { [x: string]: any; slug: string }) => ({
    params: { slug: entry.slug },
    props: { entry },
  }));
}

const imageClass =
  entry.data.image.device === "desktop" ? "md:max-w-2xl" : "md:w-[360px]";
---

<Layout title={`Agostina Giannelli • ${entry.data.title}`}>
  <Container class="space-y-16">
    <div id="unauthorized" class="mt-36 hidden">
      <Block
        h2="Glad You Stopped By"
        paragraph="Case studies are password-protected. Want to explore?"
        link="/login"
        linkText="Login"
      />
    </div>
    <div id="authorized" class="mt-16 hidden">
      <div class="mx-auto max-w-3xl text-black dark:text-white">
        <p class="uppercase tracking-wider text-sm font-medium mb-3">
          {entry.data.category}
        </p>
        <h1
          class="text-4xl lg:text-5xl font-bold lg:tracking-tight lg:leading-tight"
        >
          {entry.data.title}
        </h1>
        <div
          class="flex gap-2 mt-3 items-center flex-wrap md:flex-nowrap text-slate-500 dark:text-white"
        >
          <a
            href={entry.data.link}
            target="_blank"
            rel="noopener noreferrer"
            class="relative leading-5 dark:after:bg-white after:bg-slate-500 after:absolute after:h-0.5 after:w-0 after:bottom-0 after:left-0 hover:after:w-full after:transition-all after:duration-300 cursor-pointer"
          >
            → Website
          </a>
          <span class="block">•</span>
          <div class="w-auto flex flex-wrap gap-2">
            {entry.data.tools.map((tool: unknown) => <span>{tool}</span>)}
          </div>
        </div>
      </div>

      <div
        class="mx-auto prose prose-lg mt-6 max-w-3xl text-black dark:text-white"
      >
        {entry.data.description}
      </div>

      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 mt-6">
        {
          [
            { label: "Challenge", content: entry.data.challenge, number: "01" },
            { label: "Goal", content: entry.data.goal, number: "02" },
            {
              label: "Hypothesis",
              content: entry.data.hypothesis,
              number: "03",
            },
            {
              label: "Implementation",
              content: entry.data.implementation,
              number: "04",
            },
            { label: "Outcome", content: entry.data.outcome, number: "05" },
            {
              label: "Key Learnings",
              content: entry.data.keyLearnings,
              number: "06",
            },
          ].map(({ label, content, number }) => (
            <div class="relative flex flex-col items-start p-6 bg-black dark:bg-slate-900 border border-slate-800 dark:border-slate-700 rounded-lg transition duration-500 ease-in-out transform shadow-xl overflow-hidden group hover:-translate-y-1 hover:shadow-2xl">
              <h4 class="mb-2 text-6xl font-bold tracking-tight text-slate-200 dark:text-white">
                {number}
              </h4>
              <h5 class="mb-2 text-2xl font-bold tracking-tight text-slate-200 dark:text-white">
                {label}
              </h5>
              <p class="font-normal text-slate-400 dark:text-slate-200">
                {content}
              </p>
            </div>
          ))
        }
      </div>

      <div
        class={`${imageClass} mx-auto mt-8 transition duration-500 ease-in-out transform shadow-xl overflow-hidden rounded-lg group hover:-translate-y-1 hover:shadow-2xl`}
      >
        <div
          class="w-full h-11 rounded-t-lg bg-gray-200 flex justify-start items-center space-x-1.5 px-3"
        >
          <span class="w-3 h-3 rounded-full bg-red-400"></span>
          <span class="w-3 h-3 rounded-full bg-yellow-400"></span>
          <span class="w-3 h-3 rounded-full bg-green-400"></span>
        </div>
        <div class="w-full overflow-hidden">
          <a href={entry.data.link} target="_blank" rel="noopener noreferrer">
            <img
              src={entry.data.image.src}
              alt={entry.data.image.alt}
              class="w-full h-auto object-cover transition duration-500 transform group-hover:scale-105"
            />
          </a>
        </div>
      </div>

      <div class="text-center mt-8">
        <ButtonLink href="/case-studies">← Back to Case Studies</ButtonLink>
      </div>
    </div>
  </Container>

  <script src="../../utils/authContent.js"></script>
</Layout>
